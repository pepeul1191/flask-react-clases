{% extends './_blank.html' %}
{% block extra_head %}
<style>
  body {
    background-color: #f8f9fa;
  }
  .login-container {
    max-width: 400px;
    margin: 80px auto;
    padding: 20px;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }
</style>
{% endblock %}
{% block content %}

<div class="login-container">
  <h3 class="text-center mb-4">Iniciar Sesión</h3>

  <form id="loginForm" method="POST" action="/sign-in">
    {%if locals['message'] != ''%}
    <div class="alert alert-danger" role="alert">
      {{locals['message']}}
    </div>
    {%endif%}
    <!-- Usuario -->
    <div class="mb-3">
      <label for="username" class="form-label">Usuario</label>
      <input type="text" class="form-control" id="txtUser" name="username" placeholder="Ingresa tu usuario" required>
    </div>
    <!-- Contraseña -->
    <div class="mb-3">
      <label for="password" class="form-label">Contraseña</label>
      <input type="password" class="form-control" id="txtPassword" name="password" placeholder="Ingresa tu contraseña" required>
    </div>
    <!-- Botón de Inicio de Sesión -->
    <button type="submit" class="btn btn-primary w-100" id="btnSignIn">Iniciar Sesión</button>
  </form>

  <!-- Mensaje de alerta (oculto por defecto) -->
  <div id="alertMessage" class="alert alert-danger mt-3 d-none" role="alert">
    Usuario o contraseña incorrectos.
  </div>
</div>

{% endblock %}
{% block extra_scripts %}
<script>
  document.getElementById('btnSignIn').addEventListener('click', (event) => {
    event.preventDefault();
    const user = document.getElementById('txtUser').value;
    const password = document.getElementById('txtPassword').value;
    axios.post('/sign-in', {
      username: user,
      password: password,
    }).then(function(response) {
      // Manejo de la respuesta exitosa
      if (response.data) {
        localStorage.setItem('jwtToken', response.data);  // Guardar el token en el almacenamiento local
        window.location.href = '/admin';  // Redireccionar al usuario
      } else {
        throw new Error('No se recibió token');
      }
    })
    .catch(function(error) {
      // Manejo de errores
      console.error('Error:', error);
      const message = error.response.data;
      document.getElementById('alertMessage').classList.remove('d-none');
      document.getElementById('alertMessage').textContent = message || 'Error desconocido';
    });
  });
</script>
{% endblock %}